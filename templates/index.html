<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPCDC - Machine Learning Clustering Model</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>AI-Powered Failure Prevention for CTTI</h1>
        </div>
    </header>

    <main>
        <div class="container">
            {% if use_mock %}
            <div class="notification">
                <i class="fas fa-info-circle"></i> Running in demo mode. Set a valid Databricks token in the .env file to enable full functionality.
            </div>
            {% endif %}
            
            <div class="content-wrapper">
                <section class="main-content">
                    <h2>Welcome!</h2>
                    <!-- <p>Welcome to the Machine Learning Clustering Model for Predictive Change and Incident Management.</p> -->
                    
                    <div class="project-description">
                        <h3>Introduction</h3>
                        <p>In the Centre de Telecomunicacions i Tecnologies de la Informació (CTTI) managing of critical government applications involves frequent changes and responses to emerging errors and incidents. However, CTTI's current reactive approach fixes incidents post-occurrence, leading to server downtime, operational inefficiencies, and resource waste. This project seeks a paradigm shift from reactive to <strong>preventive management</strong> by exploiting data relating CTTI operator changes with applications incidents.</p>

                        <h3>Machine Learning Models</h3>
                        <p><strong>Machine learning models</strong> are trained with this data: two <strong>clustering algorithms</strong> provide contextual information about structured patterns in changes and incidents, while a <strong>random forest classifier</strong> relates changes directly to the type of incident (affectation) they may produce, serving as a predictive label. This multi-modal analysis helps us obtain rich context about changes, incidents, and their interrelations.</p>

                        <h3>AI Integration</h3>
                        <p>This context is then leveraged by a <strong>natural language processing AI</strong> using <strong>cache-augmented generation (CAG)</strong>. A <strong>large language model (LLM)</strong> like Gemini 2.5 Flash interprets the situation surrounding a potential change and proposes three detailed action plans with their respective <strong>confidence intervals</strong>, enabling CTTI operators to make more data-informed decisions.</p>

                        <h3>Web Application</h3>
                        <p>To make this workflow readily accessible, a <strong>web application</strong> facilitates these features. Within this application, an operator can input details of a planned change, receive the <strong>predicted potential incident type</strong> along with its <strong>confidence intervals</strong> derived from the classifier probabilities, and interact with the <strong>LLM agent</strong> to obtain nuanced interpretations of the risk and clever, preventative action plans.</p>

                        <h3>Clustering Model Visualization</h3>
                        <div class="cluster-images">
                            <div class="cluster-image-container">
                                <h4>Changes Clustering</h4>
                                <img src="{{ url_for('static', filename='images/cluster_changes.png') }}" alt="Changes Clustering Model" class="cluster-img">
                                <p>Visualization of the clustering model for infrastructure changes, showing patterns based on type and time-to-complete.</p>
                            </div>
                            <div class="cluster-image-container">
                                <h4>Incidents Clustering</h4>
                                <img src="{{ url_for('static', filename='images/cluster_incidents.png') }}" alt="Incidents Clustering Model" class="cluster-img">
                                <p>Visualization of the clustering model for incidents, showing patterns based on type and time-to-resolve.</p>
                            </div>
                        </div>
                    </div>

                    <div class="change-classification-section" id="changeClassificationSection">
                        <h3>Change Classification</h3>
                        
                        <div class="classification-layout">
                            <div class="classification-description">
                                <p>This tool allows you to classify a potential infrastructure change based on its characteristics. By providing details such as Service ID, Service CI, Categorization Tiers, and Product Categories, the system will use the trained machine learning model to predict the likely <strong>Priority</strong> (e.g., P1, P2, P3, P4).</p>
                                <p>This classification can help assess the potential risk associated with the change and inform preventive measures.</p>
                                <!-- Add more descriptive text here if needed -->
                            </div>
                            
                            <div class="classification-form-container">
                                <form id="changeClassificationForm" class="change-form">
                                    <div class="form-group">
                                        <label for="infrastructure_change_id">Change ID*</label>
                                        <input type="text" id="infrastructure_change_id" name="infrastructure_change_id" required>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="submit_date">Submit Date*</label>
                                            <input type="datetime-local" id="submit_date" name="submit_date" required>
                                        </div>
                                        
                                    <div class="form-group">
                                        <label for="scheduled_start_date">Scheduled Start Date</label>
                                        <input type="datetime-local" id="scheduled_start_date" name="scheduled_start_date">
                                    </div>
                                        
                                    <div class="form-group">
                                        <label for="scheduled_end_date">Scheduled End Date</label>
                                        <input type="datetime-local" id="scheduled_end_date" name="scheduled_end_date">
                                    </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="f01_chr_serviceid">Service ID*</label>
                                            <input type="text" id="f01_chr_serviceid" name="f01_chr_serviceid" required>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="serviceci">Service CI*</label>
                                            <input type="text" id="serviceci" name="serviceci" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="ASORG">AS Organization</label>
                                            <input type="text" id="ASORG" name="ASORG">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="ASGRP">AS Group</label>
                                            <input type="text" id="ASGRP" name="ASGRP">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="categorization_tier_1">Categorization Tier 1</label>
                                            <select id="categorization_tier_1" name="categorization_tier_1">
                                                <option value="">Select...</option>
                                                <option value="INFRAESTRUCTURA">INFRAESTRUCTURA</option>
                                                <option value="DESPLEGAMENT MULTIAMBIT">DESPLEGAMENT MULTIAMBIT</option>
                                                <option value="DESPLEGAMENT">DESPLEGAMENT</option>
                                                <option value="SEGURETAT">SEGURETAT</option>
                                                <option value="INFRAESTRUCTURA MULTIAMBIT">INFRAESTRUCTURA MULTIAMBIT</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="categorization_tier_2">Categorization Tier 2</label>
                                            <input type="text" id="categorization_tier_2" name="categorization_tier_2">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="categorization_tier_3">Categorization Tier 3</label>
                                            <input type="text" id="categorization_tier_3" name="categorization_tier_3">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="product_cat_tier_1">Product Category Tier 1</label>
                                            <input type="text" id="product_cat_tier_1" name="product_cat_tier_1">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="product_cat_tier_2">Product Category Tier 2</label>
                                            <input type="text" id="product_cat_tier_2" name="product_cat_tier_2">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="product_cat_tier_3">Product Category Tier 3</label>
                                            <input type="text" id="product_cat_tier_3" name="product_cat_tier_3">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="change_request_status">Change Request Status</label>
                                            <input type="number" id="change_request_status" name="change_request_status" min="0" value="0">
                                        </div>

                                        <div class="form-group">
                                            <label for="f01_chr_tipoafectacion">Type of Affectation (Tipus Afectació)*</label>
                                            <select id="f01_chr_tipoafectacion" name="f01_chr_tipoafectacion" required>
                                                <option value="">Select...</option>
                                                <option value="SENSE TALL DE SERVEI">SENSE TALL DE SERVEI</option>
                                                <option value="DEGRADACIO">DEGRADACIO</option>
                                                <option value="TALL DE SERVEI">TALL DE SERVEI</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" id="submitChangeBtn" class="btn-primary">
                                            <i class="fas fa-analytics"></i> Analyze Change
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div id="classificationResults" class="classification-results hidden">
                            <h4>Classification Results</h4>
                            <div id="resultsContent" class="results-content">
                                <!-- Prediction will be displayed here -->
                            </div>
                            <div id="actionablePlansContent" class="actionable-plans-content" style="margin-top: 20px;">
                                <!-- Actionable plans will be displayed here -->
                            </div>
                        </div>
                    </div>
                </section>
                
                <aside class="sidebar">
                    <div class="chatbot-container">
                        <div class="chatbot-header">
                            <h3><i class="fas fa-robot"></i> ML Insights Assistant</h3>
                        </div>
                        <div class="chatbot-messages" id="chatMessages">
                            <div class="message bot">
                                <div class="message-content">
                                    Hello! I'm your ML Insights Assistant. Please use the form below <a href="#changeClassificationSection" class="scroll-to-form">Scroll to form</a> to submit detailed change information for classification.
                                    {% if use_mock %}
                                    <br><br><small><i>Note: I'm currently running in demo mode with predefined responses.</i></small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="chatbot-input">
                            <input type="text" id="userInput" placeholder="Type your message here..." disabled>
                            <button id="sendButton" disabled><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 MPCDC - Machine Learning Clustering Model</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/marked.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
    <script src="{{ url_for('static', filename='js/change-classification.js') }}"></script>
</body>
</html>
